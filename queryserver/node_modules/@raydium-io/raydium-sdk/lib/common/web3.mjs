var B=Object.defineProperty,L=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var b=(n,r,t)=>r in n?B(n,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[r]=t,y=(n,r)=>{for(var t in r||(r={}))W.call(r,t)&&b(n,t,r[t]);if(A)for(var t of A(r))z.call(r,t)&&b(n,t,r[t]);return n},O=(n,r)=>L(n,K(r));var E=(n,r,t)=>new Promise((e,o)=>{var i=l=>{try{c(t.next(l))}catch(s){o(s)}},a=l=>{try{c(t.throw(l))}catch(s){o(s)}},c=l=>l.done?e(l.value):Promise.resolve(l.value).then(i,a);c((t=t.apply(n,r)).next())});import{PublicKey as d,Transaction as R}from"@solana/web3.js";function S(n,r=1,t=[]){let e=[...n];if(r<=0)return t;for(;e.length;)t.push(e.splice(0,r));return t}import{PublicKey as j}from"@solana/web3.js";var w="1.1.0-beta.6";import"@colors/colors";var U=!1,P=!1,N={debug:1,default:2,info:2,warning:3,error:4,off:5},_={},T;function q(){try{let n=[];if(["NFD","NFC","NFKD","NFKC"].forEach(r=>{try{if("test".normalize(r)!=="test")throw new Error("bad normalize")}catch(t){n.push(r)}}),n.length)throw new Error("missing "+n.join(", "));if(String.fromCharCode(233).normalize("NFD")!==String.fromCharCode(101,769))throw new Error("broken implementation")}catch(n){if(n instanceof Error)return n.message}return""}var M=q(),k=(i=>(i.DEBUG="DEBUG",i.INFO="INFO",i.WARNING="WARNING",i.ERROR="ERROR",i.OFF="OFF",i))(k||{}),F=(g=>(g.UNKNOWN_ERROR="UNKNOWN_ERROR",g.NOT_IMPLEMENTED="NOT_IMPLEMENTED",g.UNSUPPORTED_OPERATION="UNSUPPORTED_OPERATION",g.NETWORK_ERROR="NETWORK_ERROR",g.RPC_ERROR="RPC_ERROR",g.TIMEOUT="TIMEOUT",g.BUFFER_OVERRUN="BUFFER_OVERRUN",g.NUMERIC_FAULT="NUMERIC_FAULT",g.MISSING_NEW="MISSING_NEW",g.INVALID_ARGUMENT="INVALID_ARGUMENT",g.MISSING_ARGUMENT="MISSING_ARGUMENT",g.UNEXPECTED_ARGUMENT="UNEXPECTED_ARGUMENT",g.INSUFFICIENT_FUNDS="INSUFFICIENT_FUNDS",g))(F||{}),x="0123456789abcdef";function v(n,r=!1){let t=n;try{if(n instanceof Uint8Array){let e="";for(let o=0;o<n.length;o++)e+=x[n[o]>>4],e+=x[n[o]&15];t=`Uint8Array(0x${e})`}else if(n instanceof j)t=`PublicKey(${n.toBase58()})`;else if(n instanceof Object&&!r){let e={};Object.entries(n).forEach(([o,i])=>{e[o]=v(i,!0)}),t=JSON.stringify(e)}else r||(t=JSON.stringify(n))}catch(e){t=JSON.stringify(n.toString())}return t}var u=class{constructor(r){this.version=w;this.moduleName=r}_log(r,t){let e=r.toLowerCase();N[e]==null&&this.throwArgumentError("invalid log level name","logLevel",r),!((_[this.moduleName]||N.default)>N[e])&&console.log(...t)}debug(...r){this._log(u.levels.DEBUG,["[DEBUG]".blue,...r])}info(...r){this._log(u.levels.INFO,["[INFO]".green,...r])}warn(...r){this._log(u.levels.WARNING,["[WARN]".yellow,...r])}makeError(r,t,e){if(P)return this.makeError("censored error",t,{});t||(t=u.errors.UNKNOWN_ERROR),e||(e={});let o=[];Object.entries(e).forEach(([c,l])=>{o.push(`${c}=${v(l)})`)}),o.push(`code=${t}`),o.push(`module=${this.moduleName}`),o.push(`version=${this.version}`);let i=r;o.length&&(r+=" ("+o.join(", ")+")");let a=new Error(r);return a.reason=i,a.code=t,Object.entries(e).forEach(([c,l])=>{a[c]=l}),a}throwError(r,t,e){throw this.makeError(r,t,e)}throwArgumentError(r,t,e){return this.throwError(r,u.errors.INVALID_ARGUMENT,{argument:t,value:e})}assert(r,t,e,o){r||this.throwError(t,e,o)}assertArgument(r,t,e,o){r||this.throwArgumentError(t,e,o)}checkNormalize(r){r==null&&(r="platform missing String.prototype.normalize"),M&&this.throwError("platform missing String.prototype.normalize",u.errors.UNSUPPORTED_OPERATION,{operation:"String.prototype.normalize",form:M})}checkSafeUint53(r,t){typeof r=="number"&&(t==null&&(t="value not safe"),(r<0||r>=9007199254740991)&&this.throwError(t,u.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"out-of-safe-range",value:r}),r%1&&this.throwError(t,u.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"non-integer",value:r}))}checkArgumentCount(r,t,e){e?e=": "+e:e="",r<t&&this.throwError("missing argument"+e,u.errors.MISSING_ARGUMENT,{count:r,expectedCount:t}),r>t&&this.throwError("too many arguments"+e,u.errors.UNEXPECTED_ARGUMENT,{count:r,expectedCount:t})}checkNew(r,t){(r===Object||r==null)&&this.throwError("missing new",u.errors.MISSING_NEW,{name:t.name})}checkAbstract(r,t){r===t?this.throwError("cannot instantiate abstract class "+JSON.stringify(t.name)+" directly; use a sub-class",u.errors.UNSUPPORTED_OPERATION,{name:r.name,operation:"new"}):(r===Object||r==null)&&this.throwError("missing new",u.errors.MISSING_NEW,{name:t.name})}static globalLogger(){return T||(T=new u(w)),T}static setCensorship(r,t){if(!r&&t&&this.globalLogger().throwError("cannot permanently disable censorship",u.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"}),U){if(!r)return;this.globalLogger().throwError("error censorship permanent",u.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"})}P=!!r,U=!!t}static setLogLevel(r,t){let e=N[t.toLowerCase()];if(e==null){u.globalLogger().warn("invalid log level - "+t);return}_[r]=e}static from(r){return new u(r)}},p=u;p.errors=F,p.levels=k;var h=p.from("common/web3");function J(n,r,t){return E(this,null,function*(){let{batchRequest:e,commitment:o}=y({batchRequest:!1},t),i=S(r,100),a=new Array(i.length).fill([]);if(e){let c=i.map(s=>({methodName:"getMultipleAccounts",args:n._buildArgs([s.map(m=>m.toBase58())],o,"base64")}));a=(yield n._rpcBatchRequest(c)).map(s=>s.error?h.throwError("failed to get info for multiple accounts",p.errors.RPC_ERROR,{message:s.error.message}):s.result.value.map(f=>{if(f){let{data:m,executable:I,lamports:g,owner:C,rentEpoch:D}=f;return m.length!==2&&m[1]!=="base64"?h.throwError("info must be base64 encoded",p.errors.RPC_ERROR):{data:Buffer.from(m[0],"base64"),executable:I,lamports:g,owner:new d(C),rentEpoch:D}}else return null}))}else try{a=yield Promise.all(i.map(c=>n.getMultipleAccountsInfo(c,o)))}catch(c){if(c instanceof Error)return h.throwError("failed to get info for multiple accounts",p.errors.RPC_ERROR,{message:c.message})}return a.flat()})}function fr(n,r,t){return E(this,null,function*(){let e=yield J(n,r.map(o=>o.pubkey),t);return r.map((o,i)=>O(y({},o),{accountInfo:e[i]}))})}function G(n,r){if(n.length<1)return h.throwArgumentError("no instructions provided","instructions",n);if(r.length<1)return h.throwArgumentError("no signers provided","signers",r);let t=new R({recentBlockhash:"11111111111111111111111111111111",feePayer:r[0]});t.add(...n);try{return t.serialize({verifySignatures:!1}),!0}catch(e){return!1}}function gr(n,r,t,e=!0){return E(this,null,function*(){let o=new d("RaydiumSimuLateTransaction11111111111111111"),i=[],a=new R;a.feePayer=o;for(let s of r)G([...a.instructions,s],[o])||(i.push(a),a=new R,a.feePayer=o),a.add(s);a.instructions.length>0&&i.push(a);let c=[];try{if(c=yield V(n,i,e),c.find(s=>s.err!==null))throw Error("rpc simulateTransaction error")}catch(s){if(s instanceof Error)return h.throwError("failed to simulate for instructions",p.errors.RPC_ERROR,{message:s.message})}let l=[];for(let s of c)if(h.debug("simulate result:",s),s.logs){let f=s.logs.filter(m=>m&&m.includes(t));h.debug("filteredLog:",l),h.assertArgument(f.length!==0,"simulate log not match keyword","keyword",t),l.push(...f)}return l})}function mr(n,r){let t=n.match(/{["\w:,]+}/g);return!t||t.length!==1?h.throwArgumentError("simulate log fail to match json","keyword",r):t[0]}function hr(n,r){let e=new RegExp(`"${r}":(\\d+)`,"g").exec(n);return!e||e.length!==2?h.throwArgumentError("simulate log fail to match key","key",r):e[1]}function V(n,r,t){return E(this,null,function*(){let e=[];if(t){let o=yield n.getLatestBlockhash(),i=[];for(let s of r){s.recentBlockhash=o.blockhash,s.lastValidBlockHeight=o.lastValidBlockHeight;let m=s._compile().serialize(),g=s._serialize(m).toString("base64");i.push(g)}let a=i.map(s=>({methodName:"simulateTransaction",args:n._buildArgs([s],void 0,"base64")})),c=[],l=20;for(let s=0;s<Math.ceil(a.length/l);s++)c.push(a.slice(s*l,(s+1)*l));e=yield(yield Promise.all(c.map(s=>E(this,null,function*(){return(yield n._rpcBatchRequest(s)).map(f=>f.result.value)})))).flat()}else try{e=yield Promise.all(r.map(o=>E(this,null,function*(){return yield(yield n.simulateTransaction(o)).value})))}catch(o){if(o instanceof Error)return h.throwError("failed to get info for multiple accounts",p.errors.RPC_ERROR,{message:o.message})}return e})}function pr({instructions:n,signers:r,payer:t}){let e={};for(let a of r)e[a.publicKey.toString()]=a;let o=[],i=[];for(let a of n){let c=[...i,a],l=new Set(c.map(f=>f.keys.filter(m=>m.isSigner).map(m=>m.pubkey.toString())).flat()),s=[...l.values()].map(f=>new d(f));G(c,[t,...s])?i.push(a):(o.push({transaction:new R().add(...i),signer:[...l.values()].map(f=>e[f]).filter(f=>f!==void 0)}),i=[a])}if(i.length>0){let a=new Set(i.map(c=>c.keys.filter(l=>l.isSigner).map(l=>l.pubkey.toString())).flat());o.push({transaction:new R().add(...i),signer:[...a.values()].map(c=>e[c]).filter(c=>c!==void 0)})}return o}export{G as forecastTransactionSize,J as getMultipleAccountsInfo,fr as getMultipleAccountsInfoWithCustomFlags,mr as parseSimulateLogToJson,hr as parseSimulateValue,gr as simulateMultipleInstruction,V as simulateTransaction,pr as splitTxAndSigners};
//# sourceMappingURL=web3.mjs.map