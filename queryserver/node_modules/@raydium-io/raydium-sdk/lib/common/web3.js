"use strict";var N=Object.defineProperty,z=Object.defineProperties,j=Object.getOwnPropertyDescriptor,q=Object.getOwnPropertyDescriptors,J=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var O=(e,r,t)=>r in e?N(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,w=(e,r)=>{for(var t in r||(r={}))S.call(r,t)&&O(e,t,r[t]);if(b)for(var t of b(r))V.call(r,t)&&O(e,t,r[t]);return e},U=(e,r)=>z(e,q(r));var $=(e,r)=>{for(var t in r)N(e,t,{get:r[t],enumerable:!0})},X=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of J(r))!S.call(e,o)&&o!==t&&N(e,o,{get:()=>r[o],enumerable:!(n=j(r,o))||n.enumerable});return e};var H=e=>X(N({},"__esModule",{value:!0}),e);var R=(e,r,t)=>new Promise((n,o)=>{var i=l=>{try{c(t.next(l))}catch(s){o(s)}},a=l=>{try{c(t.throw(l))}catch(s){o(s)}},c=l=>l.done?n(l.value):Promise.resolve(l.value).then(i,a);c((t=t.apply(e,r)).next())});var nr={};$(nr,{forecastTransactionSize:()=>I,getMultipleAccountsInfo:()=>B,getMultipleAccountsInfoWithCustomFlags:()=>Y,parseSimulateLogToJson:()=>rr,parseSimulateValue:()=>tr,simulateMultipleInstruction:()=>Z,simulateTransaction:()=>L,splitTxAndSigners:()=>er});module.exports=H(nr);var E=require("@solana/web3.js");function P(e,r=1,t=[]){let n=[...e];if(r<=0)return t;for(;n.length;)t.push(n.splice(0,r));return t}var v=require("@solana/web3.js");var T="1.1.0-beta.6";var cr=require("@colors/colors"),_=!1,M=!1,y={debug:1,default:2,info:2,warning:3,error:4,off:5},x={},d;function Q(){try{let e=[];if(["NFD","NFC","NFKD","NFKC"].forEach(r=>{try{if("test".normalize(r)!=="test")throw new Error("bad normalize")}catch(t){e.push(r)}}),e.length)throw new Error("missing "+e.join(", "));if(String.fromCharCode(233).normalize("NFD")!==String.fromCharCode(101,769))throw new Error("broken implementation")}catch(e){if(e instanceof Error)return e.message}return""}var k=Q(),G=(i=>(i.DEBUG="DEBUG",i.INFO="INFO",i.WARNING="WARNING",i.ERROR="ERROR",i.OFF="OFF",i))(G||{}),C=(g=>(g.UNKNOWN_ERROR="UNKNOWN_ERROR",g.NOT_IMPLEMENTED="NOT_IMPLEMENTED",g.UNSUPPORTED_OPERATION="UNSUPPORTED_OPERATION",g.NETWORK_ERROR="NETWORK_ERROR",g.RPC_ERROR="RPC_ERROR",g.TIMEOUT="TIMEOUT",g.BUFFER_OVERRUN="BUFFER_OVERRUN",g.NUMERIC_FAULT="NUMERIC_FAULT",g.MISSING_NEW="MISSING_NEW",g.INVALID_ARGUMENT="INVALID_ARGUMENT",g.MISSING_ARGUMENT="MISSING_ARGUMENT",g.UNEXPECTED_ARGUMENT="UNEXPECTED_ARGUMENT",g.INSUFFICIENT_FUNDS="INSUFFICIENT_FUNDS",g))(C||{}),F="0123456789abcdef";function D(e,r=!1){let t=e;try{if(e instanceof Uint8Array){let n="";for(let o=0;o<e.length;o++)n+=F[e[o]>>4],n+=F[e[o]&15];t=`Uint8Array(0x${n})`}else if(e instanceof v.PublicKey)t=`PublicKey(${e.toBase58()})`;else if(e instanceof Object&&!r){let n={};Object.entries(e).forEach(([o,i])=>{n[o]=D(i,!0)}),t=JSON.stringify(n)}else r||(t=JSON.stringify(e))}catch(n){t=JSON.stringify(e.toString())}return t}var u=class{constructor(r){this.version=T;this.moduleName=r}_log(r,t){let n=r.toLowerCase();y[n]==null&&this.throwArgumentError("invalid log level name","logLevel",r),!((x[this.moduleName]||y.default)>y[n])&&console.log(...t)}debug(...r){this._log(u.levels.DEBUG,["[DEBUG]".blue,...r])}info(...r){this._log(u.levels.INFO,["[INFO]".green,...r])}warn(...r){this._log(u.levels.WARNING,["[WARN]".yellow,...r])}makeError(r,t,n){if(M)return this.makeError("censored error",t,{});t||(t=u.errors.UNKNOWN_ERROR),n||(n={});let o=[];Object.entries(n).forEach(([c,l])=>{o.push(`${c}=${D(l)})`)}),o.push(`code=${t}`),o.push(`module=${this.moduleName}`),o.push(`version=${this.version}`);let i=r;o.length&&(r+=" ("+o.join(", ")+")");let a=new Error(r);return a.reason=i,a.code=t,Object.entries(n).forEach(([c,l])=>{a[c]=l}),a}throwError(r,t,n){throw this.makeError(r,t,n)}throwArgumentError(r,t,n){return this.throwError(r,u.errors.INVALID_ARGUMENT,{argument:t,value:n})}assert(r,t,n,o){r||this.throwError(t,n,o)}assertArgument(r,t,n,o){r||this.throwArgumentError(t,n,o)}checkNormalize(r){r==null&&(r="platform missing String.prototype.normalize"),k&&this.throwError("platform missing String.prototype.normalize",u.errors.UNSUPPORTED_OPERATION,{operation:"String.prototype.normalize",form:k})}checkSafeUint53(r,t){typeof r=="number"&&(t==null&&(t="value not safe"),(r<0||r>=9007199254740991)&&this.throwError(t,u.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"out-of-safe-range",value:r}),r%1&&this.throwError(t,u.errors.NUMERIC_FAULT,{operation:"checkSafeInteger",fault:"non-integer",value:r}))}checkArgumentCount(r,t,n){n?n=": "+n:n="",r<t&&this.throwError("missing argument"+n,u.errors.MISSING_ARGUMENT,{count:r,expectedCount:t}),r>t&&this.throwError("too many arguments"+n,u.errors.UNEXPECTED_ARGUMENT,{count:r,expectedCount:t})}checkNew(r,t){(r===Object||r==null)&&this.throwError("missing new",u.errors.MISSING_NEW,{name:t.name})}checkAbstract(r,t){r===t?this.throwError("cannot instantiate abstract class "+JSON.stringify(t.name)+" directly; use a sub-class",u.errors.UNSUPPORTED_OPERATION,{name:r.name,operation:"new"}):(r===Object||r==null)&&this.throwError("missing new",u.errors.MISSING_NEW,{name:t.name})}static globalLogger(){return d||(d=new u(T)),d}static setCensorship(r,t){if(!r&&t&&this.globalLogger().throwError("cannot permanently disable censorship",u.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"}),_){if(!r)return;this.globalLogger().throwError("error censorship permanent",u.errors.UNSUPPORTED_OPERATION,{operation:"setCensorship"})}M=!!r,_=!!t}static setLogLevel(r,t){let n=y[t.toLowerCase()];if(n==null){u.globalLogger().warn("invalid log level - "+t);return}x[r]=n}static from(r){return new u(r)}},p=u;p.errors=C,p.levels=G;var h=p.from("common/web3");function B(e,r,t){return R(this,null,function*(){let{batchRequest:n,commitment:o}=w({batchRequest:!1},t),i=P(r,100),a=new Array(i.length).fill([]);if(n){let c=i.map(s=>({methodName:"getMultipleAccounts",args:e._buildArgs([s.map(m=>m.toBase58())],o,"base64")}));a=(yield e._rpcBatchRequest(c)).map(s=>s.error?h.throwError("failed to get info for multiple accounts",p.errors.RPC_ERROR,{message:s.error.message}):s.result.value.map(f=>{if(f){let{data:m,executable:A,lamports:g,owner:K,rentEpoch:W}=f;return m.length!==2&&m[1]!=="base64"?h.throwError("info must be base64 encoded",p.errors.RPC_ERROR):{data:Buffer.from(m[0],"base64"),executable:A,lamports:g,owner:new E.PublicKey(K),rentEpoch:W}}else return null}))}else try{a=yield Promise.all(i.map(c=>e.getMultipleAccountsInfo(c,o)))}catch(c){if(c instanceof Error)return h.throwError("failed to get info for multiple accounts",p.errors.RPC_ERROR,{message:c.message})}return a.flat()})}function Y(e,r,t){return R(this,null,function*(){let n=yield B(e,r.map(o=>o.pubkey),t);return r.map((o,i)=>U(w({},o),{accountInfo:n[i]}))})}function I(e,r){if(e.length<1)return h.throwArgumentError("no instructions provided","instructions",e);if(r.length<1)return h.throwArgumentError("no signers provided","signers",r);let t=new E.Transaction({recentBlockhash:"11111111111111111111111111111111",feePayer:r[0]});t.add(...e);try{return t.serialize({verifySignatures:!1}),!0}catch(n){return!1}}function Z(e,r,t,n=!0){return R(this,null,function*(){let o=new E.PublicKey("RaydiumSimuLateTransaction11111111111111111"),i=[],a=new E.Transaction;a.feePayer=o;for(let s of r)I([...a.instructions,s],[o])||(i.push(a),a=new E.Transaction,a.feePayer=o),a.add(s);a.instructions.length>0&&i.push(a);let c=[];try{if(c=yield L(e,i,n),c.find(s=>s.err!==null))throw Error("rpc simulateTransaction error")}catch(s){if(s instanceof Error)return h.throwError("failed to simulate for instructions",p.errors.RPC_ERROR,{message:s.message})}let l=[];for(let s of c)if(h.debug("simulate result:",s),s.logs){let f=s.logs.filter(m=>m&&m.includes(t));h.debug("filteredLog:",l),h.assertArgument(f.length!==0,"simulate log not match keyword","keyword",t),l.push(...f)}return l})}function rr(e,r){let t=e.match(/{["\w:,]+}/g);return!t||t.length!==1?h.throwArgumentError("simulate log fail to match json","keyword",r):t[0]}function tr(e,r){let n=new RegExp(`"${r}":(\\d+)`,"g").exec(e);return!n||n.length!==2?h.throwArgumentError("simulate log fail to match key","key",r):n[1]}function L(e,r,t){return R(this,null,function*(){let n=[];if(t){let o=yield e.getLatestBlockhash(),i=[];for(let s of r){s.recentBlockhash=o.blockhash,s.lastValidBlockHeight=o.lastValidBlockHeight;let m=s._compile().serialize(),g=s._serialize(m).toString("base64");i.push(g)}let a=i.map(s=>({methodName:"simulateTransaction",args:e._buildArgs([s],void 0,"base64")})),c=[],l=20;for(let s=0;s<Math.ceil(a.length/l);s++)c.push(a.slice(s*l,(s+1)*l));n=yield(yield Promise.all(c.map(s=>R(this,null,function*(){return(yield e._rpcBatchRequest(s)).map(f=>f.result.value)})))).flat()}else try{n=yield Promise.all(r.map(o=>R(this,null,function*(){return yield(yield e.simulateTransaction(o)).value})))}catch(o){if(o instanceof Error)return h.throwError("failed to get info for multiple accounts",p.errors.RPC_ERROR,{message:o.message})}return n})}function er({instructions:e,signers:r,payer:t}){let n={};for(let a of r)n[a.publicKey.toString()]=a;let o=[],i=[];for(let a of e){let c=[...i,a],l=new Set(c.map(f=>f.keys.filter(m=>m.isSigner).map(m=>m.pubkey.toString())).flat()),s=[...l.values()].map(f=>new E.PublicKey(f));I(c,[t,...s])?i.push(a):(o.push({transaction:new E.Transaction().add(...i),signer:[...l.values()].map(f=>n[f]).filter(f=>f!==void 0)}),i=[a])}if(i.length>0){let a=new Set(i.map(c=>c.keys.filter(l=>l.isSigner).map(l=>l.pubkey.toString())).flat());o.push({transaction:new E.Transaction().add(...i),signer:[...a.values()].map(c=>n[c]).filter(c=>c!==void 0)})}return o}0&&(module.exports={forecastTransactionSize,getMultipleAccountsInfo,getMultipleAccountsInfoWithCustomFlags,parseSimulateLogToJson,parseSimulateValue,simulateMultipleInstruction,simulateTransaction,splitTxAndSigners});
//# sourceMappingURL=web3.js.map