import{PublicKey as D}from"@solana/web3.js";import{PublicKey as He}from"@solana/web3.js";import E,{isBN as U}from"bn.js";import{bits as J,BitStructure as O,blob as N,Blob as Q,cstr as W,f32 as $,f32be as ee,f64 as te,f64be as ne,greedy as re,Layout as R,ns64 as oe,ns64be as se,nu64 as ue,nu64be as ae,offset as ie,s16 as ce,s16be as pe,s24 as ye,s24be as me,s32 as de,s32be as le,s40 as fe,s40be as xe,s48 as be,s48be as Pe,s8 as ge,seq as C,struct as Le,Structure as v,u16 as he,u16be as Te,u24 as Be,u24be as Se,u32 as _e,u32be as we,u40 as Ee,u40be as Ue,u48 as Ie,u48be as Me,u8 as ke,UInt as Ne,union as Re,Union as Ce,unionLayoutDiscriminator as ve,utf8 as De}from"@solana/buffer-layout";var B=R,S=v;var _=C;var w=N;var g=class extends B{constructor(o,u,s){super(o,s);this.blob=w(o),this.signed=u}decode(o,u=0){let s=new E(this.blob.decode(o,u),10,"le");return this.signed?s.fromTwos(this.span*8).clone():s}encode(o,u,s=0){return typeof o=="number"&&(o=new E(o)),this.signed&&(o=o.toTwos(this.span*8)),this.blob.encode(o.toArrayLike(Buffer,"le",this.span),u,s)}};function f(e){return new g(8,!1,e)}var L=class extends S{decode(r,o){return super.decode(r,o)}};function h(e,r,o){return new L(e,r,o)}function I(e,r,o){let u,s=typeof r=="number"?r:U(r)?r.toNumber():new Proxy(r,{get(a,t){if(!u){let n=Reflect.get(a,"count");u=U(n)?n.toNumber():n,Reflect.set(a,"count",u)}return Reflect.get(a,t)},set(a,t,n){return t==="count"&&(u=n),Reflect.set(a,t,n)}});return _(e,s,o)}var nt=new D("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),P=5e4,A=h([f("x"),f("y"),f("price")]),V=h([f("accountType"),f("status"),f("multiplier"),f("validDataCount"),I(A,P,"DataElement")]);function K(e,r){return[0,P-2]}function q(e){return[0,P-2]}function X(e){return[0,P-2]}function F(e,r,o){let[u,s]=K(r,o),a=u,t=s,n=0,i=r*e.multiplier/o;for(;a<=t;){if(n=Math.floor((t+a)/2),n===0||n>=P-2)return[n,n,!1];let p=e.DataElement[n].x*e.multiplier/e.DataElement[n].y,c=e.DataElement[n-1].x*e.multiplier/e.DataElement[n-1].y,y=e.DataElement[n+1].x*e.multiplier/e.DataElement[n+1].y;if(i===p)return[n,n,!0];if(i===c)return[n-1,n-1,!0];if(i===y)return[n+1,n+1,!0];if(i<c)t=n-1;else{if(i>c&&i<p)return[n-1,n,!0];if(i>p&&i<y)return[n,n+1,!0];a=n+1}}return[n,n,!1]}function T(e,r,o){let[u,s,a]=F(e,r,o);if(!a)return 0;if(u===s){let t=e.DataElement[u].x;return r*e.multiplier/t}else{let t=e.DataElement[u].x,n=e.DataElement[u].y,i=e.DataElement[s].x,p=e.DataElement[s].y,c=o*(i*n-t*p),y=t*c,m=(i-t)*(r*n-t*o)*p,d=y+m;return r*e.multiplier*c/d}}function b(e,r,o){return r*e.multiplier/o}function M(e,r,o){return r*o/e.multiplier}function Y(e,r){let[o,u]=q(r),s=o,a=u,t=0,n=r;for(;s<a;){if(t=Math.floor((a+s)/2),t<=0||t>P-2)return[t,t,!1];let i=e.DataElement[t].x,p=e.DataElement[t-1].x,c=e.DataElement[t+1].x;if(n===i)return[t,t,!0];if(n===p)return[t-1,t-1,!0];if(n===c)return[t+1,t+1,!0];if(n<p)a=t-1;else{if(n>p&&n<i)return[t-1,t,!0];if(n>i&&n<c)return[t,t+1,!0];s=t+1}}return[t,t,!1]}function j(e,r){let[o,u]=X(r),s=o,a=u,t=0,n=r;for(;s<=a;){if(t=Math.floor((a+s)/2),t<=0||t>=P-2)return[t,t,!1];let i=e.DataElement[t].y,p=e.DataElement[t-1].y,c=e.DataElement[t+1].y;if(n===i)return[t,t,!0];if(n===p)return[t-1,t-1,!0];if(n===c)return[t+1,t+1,!0];if(n<c)s=t+1;else{if(n<p&&n>i)return[t-1,t,!0];if(n<i&&n>c)return[t,t+1,!0];a=t-1}}return[t,t,!1]}function k(e,r,o,u){let s=u?r+o:r-o,[a,t,n]=Y(e,s);if(!n)return[0,0,!1,n];if(a===t)return[e.DataElement[t].price,e.DataElement[t].y,!1,n];{let i=e.DataElement[a].x,p=e.DataElement[t].x,c=e.DataElement[a].price,y=e.DataElement[t].price,m=e.DataElement[a].y,d=e.DataElement[t].y;if(r>=i&&r<=p)return u?[y,d,!0,n]:[c,m,!0,n];{let l,x;return u?(l=c+(y-c)*(r-i)/(p-i),x=m-(s-i)*e.multiplier/y):(l=c+(y-c)*(r-i)/(p-i),x=d+(p-s)*e.multiplier/c),[l,x,!1,n]}}}function z(e,r,o,u){let s=u?r-o:r+o,[a,t,n]=j(e,s);if(!n)return[0,0,!1,n];if(a===t)return[e.DataElement[t].price,e.DataElement[t].x,!1,n];{let i=e.DataElement[a].x,p=e.DataElement[t].x,c=e.DataElement[a].price,y=e.DataElement[t].price,m=e.DataElement[a].y,d=e.DataElement[t].y;if(r>=d&&r<=m)return u?[y,p,!0,n]:[c,i,!0,n];{let l,x;return u?(l=c+(y-c)*(m-r)/(m-d),x=i+y*(m-s)/e.multiplier):(l=c+(y-c)*(m-r)/(m-d),x=p-c*(s-d)/e.multiplier),[l,x,!1,n]}}}function G(e,r){let o=k(e,r,0,!1);return o[3]?o[0]:0}function rt(e,r,o,u){let s=T(e,r,o),a=b(e,r,s),t=b(e,o,s),n=b(e,u,s),i=!0,[p,c,y,m]=k(e,a,n,i);if(!m)return 0;if(y)return u*e.multiplier/p;{let d=t-c;return M(e,d,s)}}function ot(e,r,o,u){let s=T(e,r,o),a=b(e,r,s),t=b(e,o,s),n=b(e,u,s),i=!1,[p,c,y,m]=z(e,t,n,i);if(!m)return 0;if(y)return u*p/e.multiplier;{let d=a-c;return M(e,d,s)}}function st(e){let r=V.decode(e);return{accountType:r.accountType.toNumber(),status:r.status.toNumber(),multiplier:r.multiplier.toNumber(),validDataCount:r.validDataCount.toNumber(),DataElement:r.DataElement.map(o=>({x:o.x.toNumber(),y:o.y.toNumber(),price:o.price.toNumber()}))}}function ut(e,r,o,u){let s=G(e,b(e,r,T(e,r,o)))/e.multiplier;return u?s:1/s}export{A as DataElement,V as ModelDataInfo,nt as ModelDataPubkey,st as formatLayout,ot as getDxByDyBaseIn,rt as getDyByDxBaseIn,ut as getStablePrice};
//# sourceMappingURL=stable.mjs.map